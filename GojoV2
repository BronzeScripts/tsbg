local Key = Instance.new("ScreenGui")
local KeySytem = Instance.new("Frame")
local KeySystem = Instance.new("TextLabel")
local Description = Instance.new("TextLabel")
local SubmitButton = Instance.new("TextButton")
local GetKeyButton = Instance.new("TextButton")
local KeyBox = Instance.new("TextBox")

--Properties:

Key.Name = "Key"
Key.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
Key.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
Key.ResetOnSpawn = false

KeySytem.Name = "KeySytem"
KeySytem.Parent = Key
KeySytem.AnchorPoint = Vector2.new(0.5, 0.5)
KeySytem.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
KeySytem.BorderColor3 = Color3.fromRGB(10, 10, 10)
KeySytem.BorderSizePixel = 4
KeySytem.Position = UDim2.new(0.5, 0, 0.5, 0)
KeySytem.Size = UDim2.new(0, 350, 0, 200)

KeySystem.Name = "KeySystem"
KeySystem.Parent = KeySytem
KeySystem.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
KeySystem.BackgroundTransparency = 1.000
KeySystem.BorderColor3 = Color3.fromRGB(0, 0, 0)
KeySystem.BorderSizePixel = 0
KeySystem.Size = UDim2.new(1, 0, 0, 50)
KeySystem.Font = Enum.Font.GothamBold
KeySystem.Text = "KEY SYSTEM"
KeySystem.TextColor3 = Color3.fromRGB(255, 255, 255)
KeySystem.TextSize = 36.000
KeySystem.TextWrapped = true

Description.Name = "Description"
Description.Parent = KeySytem
Description.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
Description.BackgroundTransparency = 1.000
Description.BorderColor3 = Color3.fromRGB(0, 0, 0)
Description.BorderSizePixel = 0
Description.Position = UDim2.new(0, 0, 0.222000003, 0)
Description.Size = UDim2.new(1, 0, 0, 20)
Description.Font = Enum.Font.Gotham
Description.Text = "Key lasts for 24 Hours!"
Description.TextColor3 = Color3.fromRGB(255, 255, 255)
Description.TextSize = 20.000
Description.TextWrapped = true

SubmitButton.Name = "SubmitButton"
SubmitButton.Parent = KeySytem
SubmitButton.AnchorPoint = Vector2.new(0.5, 0.5)
SubmitButton.BackgroundColor3 = Color3.fromRGB(27, 27, 27)
SubmitButton.BorderColor3 = Color3.fromRGB(10, 10, 10)
SubmitButton.Position = UDim2.new(0.275000006, 0, 0.800000012, 0)
SubmitButton.Size = UDim2.new(0.425000012, 0, 0.25, 0)
SubmitButton.Font = Enum.Font.Gotham
SubmitButton.Text = "Submit"
SubmitButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SubmitButton.TextSize = 30.000
SubmitButton.TextWrapped = true

GetKeyButton.Name = "GetKeyButton"
GetKeyButton.Parent = KeySytem
GetKeyButton.AnchorPoint = Vector2.new(0.5, 0.5)
GetKeyButton.BackgroundColor3 = Color3.fromRGB(27, 27, 27)
GetKeyButton.BorderColor3 = Color3.fromRGB(10, 10, 10)
GetKeyButton.Position = UDim2.new(0.725000024, 0, 0.800000012, 0)
GetKeyButton.Size = UDim2.new(0.425000012, 0, 0.25, 0)
GetKeyButton.Font = Enum.Font.Gotham
GetKeyButton.Text = "Get Key"
GetKeyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
GetKeyButton.TextSize = 30.000
GetKeyButton.TextWrapped = true

KeyBox.Name = "KeyBox"
KeyBox.Parent = KeySytem
KeyBox.AnchorPoint = Vector2.new(0.5, 0.5)
KeyBox.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
KeyBox.BorderColor3 = Color3.fromRGB(20, 20, 20)
KeyBox.BorderSizePixel = 2
KeyBox.Position = UDim2.new(0.5, 0, 0.5, 0)
KeyBox.Size = UDim2.new(0.899999976, 0, 0, 50)
KeyBox.Font = Enum.Font.Gotham
KeyBox.Text = ""
KeyBox.TextColor3 = Color3.fromRGB(255, 255, 255)
KeyBox.TextSize = 28.000
KeyBox.TextWrapped = true

-- Scripts:
local script = Instance.new('LocalScript', KeySytem)


-- Store references to the GUI elements so they can be updated
local messageGui, textLabel, closeButton = nil, nil, nil

-- Plato callbacks
local function createOrUpdateMessageGui(message, delete, noclose)
	local player = game:GetService("Players").LocalPlayer
	local playerGui = player:WaitForChild("PlayerGui")

	-- Check if the GUI already exists, if not, create it
	if not messageGui then
		-- Create ScreenGui
		messageGui = Instance.new("ScreenGui")
		messageGui.Name = "MessageGui"
		messageGui.Parent = playerGui
		messageGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

		-- Create a frame for the message box
		local frame = Instance.new("Frame")
		frame.Size = UDim2.new(0.4, 0, 0.2, 0)  -- 40% of the screen width and 20% of the height
		frame.Position = UDim2.new(0.3, 0, 0.4, 0)  -- Center the frame
		frame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
		frame.BorderColor3 = Color3.fromRGB(10, 10, 10)
		frame.BorderSizePixel = 4
		frame.Parent = messageGui

		-- Create TextLabel to display the message
		textLabel = Instance.new("TextLabel")
		textLabel.Size = UDim2.new(1, 0, 0.8, 0)  -- 80% height for the message
		textLabel.Position = UDim2.new(0, 0, 0, 0)
		textLabel.BackgroundTransparency = 1
		textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
		textLabel.TextSize = 20
		textLabel.TextScaled = true
		textLabel.Font = Enum.Font.Gotham
		textLabel.TextWrapped = true
		textLabel.Text = message
		textLabel.Parent = frame

		-- Create Close Button
		closeButton = Instance.new("TextButton")
		closeButton.Size = UDim2.new(1, 0, 0.2, 0)  -- 20% height for the close button
		closeButton.Position = UDim2.new(0, 0, 0.8, 0)
		closeButton.BackgroundColor3 = Color3.fromRGB(27, 27, 27)
		closeButton.BorderColor3 = Color3.fromRGB(10, 10, 10)
		closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
		closeButton.TextSize = 20
		closeButton.Font = Enum.Font.Gotham
		closeButton.Text = "Close"
		closeButton.TextWrapped = true
		closeButton.Parent = frame
		
		if noclose then
			closeButton.Visible = false
		end

		-- Close Button functionality
		closeButton.MouseButton1Click:Connect(function()
			messageGui:Destroy()
			messageGui, textLabel = nil, nil  -- Reset references
		end)
	else
		if noclose then
			closeButton.Visible = false
		else
			closeButton.Visible = true
		end
		textLabel.Text = message
	end
	
	if delete == true then
		messageGui:Destroy()
	end
end

local function debugLog(message)
	--createOrUpdateMessageGui("DEBUG: " .. message)
end

local onMessage = function(message, printmsg, delete, noclose)
	if printmsg then
		createOrUpdateMessageGui(message, delete, noclose)
	end
end;

-- Plato configuration
local accountId = 61568; -- Plato account id [IMPORTANT]
local allowPassThrough = false; -- Allow user through if error occurs, may reduce security
local allowKeyRedeeming = false; -- Automatically check keys to redeem if valid
local useDataModel = false;

-- Plato internals [START]
local fRequest, fStringFormat, fSpawn, fWait = request or http.request or http_request or syn.request, string.format, task.spawn, task.wait;
-- Add a script-specific offset
local scriptOffset = 1 -- Change this per script, e.g., +1, +3, etc.
local localPlayerId = game:GetService("Players").LocalPlayer.UserId + scriptOffset;
local rateLimit, rateLimitCountdown, errorWait = false, 0, false;
-- Plato internals [END]

-- Plato global functions [START]
function getLink()
	return fStringFormat("https://gateway.platoboost.com/a/%i?id=%i", accountId, localPlayerId);
end;

function verify(key, printmsg)
	if errorWait or rateLimit then 
		debugLog("Verification skipped due to errorWait or rateLimit.")
		return false;
	end;

	onMessage("Checking key...", printmsg);
	onMessage("Checking key...", printmsg);

	local status, result
	if (useDataModel) then
		status, result = pcall(function() 
			return game:HttpGetAsync(fStringFormat("https://api-gateway.platoboost.com/v1/public/whitelist/%i/%i?key=%s", accountId, localPlayerId, key))
		end)

		if status then
			debugLog("Response received: " .. result)
			if string.find(result, "true") then
				onMessage("Successfully whitelisted!", printmsg, true);
				return true;
			elseif string.find(result, "false") then
				debugLog("Key is invalid, attempting redemption.")
				if allowKeyRedeeming then
					status, result = pcall(function()
						return game:HttpPostAsync(fStringFormat("https://api-gateway.platoboost.com/v1/authenticators/redeem/%i/%i/%s", accountId, localPlayerId, key), {})
					end)

					if status then
						debugLog("Redemption response received: " .. result)
						if string.find(result, "true") then
							onMessage("Successfully redeemed key!", printmsg, true);
							return true;
						end;
					else
						debugLog("Error redeeming key: " .. result)
					end
				end;

				onMessage("Key is invalid!", printmsg);
				return false;
			else
				debugLog("Unexpected response format.", printmsg)
				return false;
			end;
		else
			debugLog("Error occurred while contacting the server: " .. result)
			onMessage("An error occurred while contacting the server!", printmsg);
			return allowPassThrough;
		end;
	else
		status, result = pcall(function() 
			return fRequest({
				Url = fStringFormat("https://api-gateway.platoboost.com/v1/public/whitelist/%i/%i?key=%s", accountId, localPlayerId, key),
				Method = "GET"
			})
		end)

		if status then
			debugLog("Response received: " .. result.Body)
			if result.StatusCode == 200 then
				if string.find(result.Body, "true") then
					onMessage("Successfully whitelisted key!", printmsg, true);
					return true;
				else
					if allowKeyRedeeming then
						debugLog("Key is not whitelisted, attempting redemption.")
						status, result = pcall(function() 
							return fRequest({
								Url = fStringFormat("https://api-gateway.platoboost.com/v1/authenticators/redeem/%i/%i/%s", accountId, localPlayerId, key),
								Method = "POST"
							})
						end)

						if status then
							debugLog("Redemption response received: " .. result.Body)
							if result.StatusCode == 200 then
								if string.find(result.Body, "true") then
									onMessage("Successfully redeemed key!", printmsg, true);
									return true;
								end;
							end;
						else
							debugLog("Error redeeming key: " .. result)
						end
					end;

					onMessage("Key is invalid!", printmsg);
					return false;
				end;
			elseif result.StatusCode == 204 then
				debugLog("Account wasn't found.")
				onMessage("Account wasn't found, check accountId", printmsg)
				return false;
			elseif result.StatusCode == 429 then
				if not rateLimit then 
					rateLimit = true;
					rateLimitCountdown = 10;
					fSpawn(function() 
						while rateLimit do
							onMessage(fStringFormat("You are being rate-limited, please slow down. Try again in %i second(s).", rateLimitCountdown), printmsg)
							fWait(1)
							rateLimitCountdown = rateLimitCountdown - 1
							if rateLimitCountdown < 0 then
								rateLimit = false
								rateLimitCountdown = 0
								onMessage("Rate limit is over, please try again.", printmsg)
							end
						end
					end) 
				end
			else
				debugLog("Unexpected status code: " .. result.StatusCode)
				return allowPassThrough;
			end;    
		else
			debugLog("Error occurred while making request: " .. result)
			return allowPassThrough;
		end;
	end;
end;

-- Plato global functions [END]

function VerifyIsTrue(key, printmsg)
	--if verify(key, sendMessage) == true then -- CHANGE TO VERIFY
	if verify(key, printmsg) == true then
		onMessage("", true, true, false)
		loadstring(game:HttpGet("https://raw.githubusercontent.com/skibiditoiletfan2007/BaldyToSorcerer/main/Latest.lua"))()
		Key.Enabled = false
	else
		SubmitButton.Active = true
		onMessage("", true, true, false)
	end
	
end

GetKeyButton.MouseButton1Click:Connect(function()
	setclipboard(getLink())
	GetKeyButton.TextScaled = true
	GetKeyButton.Text = "Link Copied"
	wait(2)
	GetKeyButton.TextScaled = false
	GetKeyButton.Text = "Get Key"
end)

SubmitButton.MouseButton1Click:Connect(function()
	local textkey = script.Parent.KeyBox.Text
	VerifyIsTrue(textkey, true)
end)

onMessage("Please Wait", true, false, true)
VerifyIsTrue("", false)
